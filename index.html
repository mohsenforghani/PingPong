<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Pong Online - Smooth Version</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: black;
        height: 100%;
        width: 100%;
    }
    canvas {
        display: block;
    }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// ØªÙ†Ø¸ÛŒÙ… Ø§Ù†Ø¯Ø§Ø²Ù‡ canvas Ø±ÙˆÛŒ Ú©Ù„ ØµÙØ­Ù‡
function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// âœ… Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Render
const ws = new WebSocket('wss://pingpong-te0t.onrender.com');

let playerId = null;
let paddleY = 0;

// ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø¨Ø§Ø²ÛŒ
let state = {
    ball: {x:400, y:300, radius:10},
    paddles: [
        {x:10, y:250, w:20, h:100},
        {x:770, y:250, w:20, h:100}
    ],
    scores: [0,0]
};

// Ø³Ø±Ø¹Øª Ø§Ù†ÛŒÙ…ÛŒØ´Ù† (Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ø±Ù…ÛŒ)
let targetState = JSON.parse(JSON.stringify(state));
let smoothing = 0.15;

// Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù… Ø§Ø² Ø³Ø±ÙˆØ±
ws.onmessage = (msg) => {
    let data = JSON.parse(msg.data);
    if(data.playerId !== undefined){
        playerId = data.playerId;
    } else {
        targetState = data;
    }
};

// Ú©Ù†ØªØ±Ù„ Ø±Ø§Ú©Øª Ø¨Ø§ Ù„Ù…Ø³ Ùˆ Ù…ÙˆØ³
function sendPaddleY(y){
    if(playerId === null) return;
    ws.send(JSON.stringify({player: playerId, y: y}));
}

// Ù…ÙˆØ³
canvas.addEventListener('mousemove', e => {
    paddleY = e.clientY - 50;
    sendPaddleY(paddleY);
});

// Ù„Ù…Ø³ Ù…ÙˆØ¨Ø§ÛŒÙ„
canvas.addEventListener('touchmove', e => {
    e.preventDefault();
    paddleY = e.touches[0].clientY - 50;
    sendPaddleY(paddleY);
}, {passive:false});

// ğŸ® Ø­Ù„Ù‚Ù‡ Ø±Ù†Ø¯Ø± Ù†Ø±Ù…
function animate(){
    requestAnimationFrame(animate);

    // Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†â€ŒÚ¯ÛŒØ±ÛŒ Ù†Ø±Ù… Ø¨ÛŒÙ† ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ùˆ ÙˆØ¶Ø¹ÛŒØª Ù‡Ø¯Ù
    state.ball.x += (targetState.ball.x - state.ball.x) * smoothing;
    state.ball.y += (targetState.ball.y - state.ball.y) * smoothing;

    for(let i=0; i<2; i++){
        state.paddles[i].y += (targetState.paddles[i].y - state.paddles[i].y) * smoothing;
        state.scores[i] = targetState.scores[i];
    }

    drawGame();
}

// Ø±Ø³Ù… Ø¨Ø§Ø²ÛŒ
function drawGame(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const scaleX = canvas.width / 800;
    const scaleY = canvas.height / 600;

    // ØªÙˆÙ¾
    ctx.fillStyle = 'white';
    ctx.beginPath();
    ctx.arc(state.ball.x * scaleX, state.ball.y * scaleY, state.ball.radius * scaleX, 0, Math.PI*2);
    ctx.fill();

    // Ø±Ø§Ú©Øªâ€ŒÙ‡Ø§
    ctx.fillStyle = 'white';
    state.paddles.forEach(p => {
        ctx.fillRect(p.x * scaleX, p.y * scaleY, p.w * scaleX, p.h * scaleY);
    });

    // Ø§Ù…ØªÛŒØ§Ø²
    ctx.font = `${30*scaleY}px Arial`;
    ctx.fillText(state.scores[0], canvas.width/4, 50*scaleY);
    ctx.fillText(state.scores[1], 3*canvas.width/4, 50*scaleY);
}

// Ø´Ø±ÙˆØ¹ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
animate();
</script>
</body>
</html>
