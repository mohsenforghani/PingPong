<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Pong Online Responsive</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: black;
        height: 100%;
        width: 100%;
    }
    canvas {
        display: block;
    }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Canvas تمام صفحه و responsive
function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// جایگزین کن با URL سرور Render خودت
const ws = new WebSocket('wss://pingpong-te0t.onrender.com');

let playerId = null;
let paddleY = 0;

// وضعیت بازی از سرور
let state = {
    ball: {x:400,y:300,radius:10},
    paddles: [{x:50,y:250,w:20,h:100},{x:730,y:250,w:20,h:100}],
    scores: [0,0]
};

// دریافت پیام از سرور
ws.onmessage = (msg) => {
    let data = JSON.parse(msg.data);
    if(data.playerId !== undefined){
        playerId = data.playerId;
    } else {
        state = data; // فقط به‌روزرسانی وضعیت
    }
}

// ارسال موقعیت راکت به سرور
function sendPaddleY(y){
    if(playerId === null) return;
    ws.send(JSON.stringify({player: playerId, y: y}));
}

// کنترل با موس
canvas.addEventListener('mousemove', e => {
    paddleY = e.clientY - state.paddles[playerId]?.h/2 || 50;
    sendPaddleY(paddleY);
});

// کنترل با لمس موبایل
canvas.addEventListener('touchmove', e => {
    e.preventDefault();
    paddleY = e.touches[0].clientY - state.paddles[playerId]?.h/2 || 50;
    sendPaddleY(paddleY);
}, {passive:false});

// رسم بازی
function drawGame(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // توپ
    ctx.fillStyle = 'white';
    ctx.beginPath();
    ctx.arc(
        state.ball.x * canvas.width / 800,
        state.ball.y * canvas.height / 600,
        state.ball.radius * canvas.width / 800,
        0, Math.PI*2
    );
    ctx.fill();

    // راکت‌ها
    state.paddles.forEach(p => {
        ctx.fillRect(
            p.x * canvas.width / 800,
            p.y * canvas.height / 600,
            p.w * canvas.width / 800,
            p.h * canvas.height / 600
        );
    });

    // دروازه‌ها (عرض کل صفحه)
    ctx.fillStyle = 'red';
    ctx.fillRect(0, 0, canvas.width, 10); // بالا
    ctx.fillRect(0, canvas.height-10, canvas.width, 10); // پایین

    // نمره
    ctx.fillStyle = 'white';
    ctx.font = "30px Arial";
    ctx.fillText(state.scores[0], canvas.width/4, 50);
    ctx.fillText(state.scores[1], 3*canvas.width/4, 50);
}

// loop مستقل برای رسم روان
function renderLoop(){
    drawGame();
    requestAnimationFrame(renderLoop);
}
renderLoop();
</script>
</body>
</html>
